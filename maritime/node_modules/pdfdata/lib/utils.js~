var request = require("request-promise");
var objectAssign = require('object-assign');

function requestOptions (pdfdata, path, options) {
    var options = objectAssign(options, pdfdata._api);
    options.url = options.url + path;
    return options;
}

function _do_request (options) {
    return request(options).then(
	function (response) {
	    var body;
	    try {
		body = JSON.parse(response.body)
	    } catch (e) {
		throw new _ResponseError(options, response,
					 "PDFDATA.io's response body was not well-formed JSON");
	    }
	    
	    if (response.statusCode > 400) {
		throw new _Error(options, response, body);
	    } else {
		response.body = body;
		return response;
	    }
	});
}

function _return_body (response) {
    return response.body;
}

module.exports = {requestOptions: requestOptions,
		  request: _do_request,
		  return_body: _return_body}
