

describe("document management", function () {
    it("upload one", function (done) {
	var file = pdfs[0];
	var document;
	pdfdata.documents.upload(file)
	    .then(function (result) {
		assert.equal(result.length, 1);
		document = result[0];
		isID("doc", document.id);
		assert.equal(document.type, "doc");
		assert.equal(document.filename, path.basename(file))
		checkDate(document.created);
		checkDate(document.expires);
		return pdfdata.documents.get(document.id);
	    })
	    .then(function (result) {
		assert.deepEqual(document, result);
		return pdfdata.documents.list();
	    })
	    .then(function (result) {
		assert.include(result, document);
		done();
	    });
    });

    it("upload many", function (done) {
	var documents;
	var filenames = pdfs.map(function (p) {
	    return path.basename(p);
	});
	var tags = ["test-tag", "Group123"];
	pdfdata.documents.upload(pdfs, tags)
	    .then(function (result) {
		assert.equal(result.length, pdfs.length);
		documents = result;
		documents.forEach(function (document) {
		    isID("doc", document.id);
		    assert.equal(document.type, "doc");
		    assert.include(filenames, document.filename);
		    checkDate(document.created);
		    checkDate(document.expires);
		    tags.forEach(function (tag) {
			assert.include(document.tags, tag);
		    });
		});

		return Promise.map(documents, function (document) {
		    return pdfdata.documents.get(document.id);
		});
	    })
	    .then(function (result) {
		documents.forEach(function (document) {
		    assert.include(result, document);
		});

                return pdfdata.documents.list();
	    })
	    .then(function (result) {
		documents.forEach(function (document) {
		    assert.include(result, document);
		});
		done();
	    }).catch(console.log);
    });
});
